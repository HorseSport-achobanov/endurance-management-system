@page "/"

@using Common.Application.Behinds;
@using EMS.Domain.Setup.Entities;
@using EMS.Judge.Setup.Events;
@using EMS.Judge.UI.Pages.Setup.Events;
@using Not.Blazor.Dialogs;

@inject INotDialogService<Event, EventCreateModel, EventFields> _notDialogService;
@inject IBehind<Event> _behind;

<MudText Typo="Typo.h1">Setup</MudText>

@if (_event == null)
{
    <MudPaper>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="RenderCreate">Create</MudButton>
    </MudPaper>
}
else
{
    <EventPage />
}

@code {
    private Event? _event;

    protected override async Task OnInitializedAsync()
    {
        _event = await _behind.Read(default);
    }

    private async Task RenderCreate()
    {
        await _notDialogService.CreateEntity(CreateEvent);
        await OnInitializedAsync();
    }

    private Event CreateEvent(IEventFields input) => new Event(input.Place!, input.Country!);
}