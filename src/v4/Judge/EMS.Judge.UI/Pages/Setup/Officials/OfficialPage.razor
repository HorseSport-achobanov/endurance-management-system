@attribute [Route(OFFICIAL_PAGE)]

@using Common.Application;
@using EMS.Domain.Setup.Entities;
@using EMS.Judge.Setup.StaffMembers;
@using EMS.Judge.UI.Services;
@using Common.Application.Behinds;
@using Not.Blazor.Forms
@using Not.Blazor.Navigation
@using Not.Blazor.TM.Forms;

@inherits UpdatePage<Official>
@inject INotBehindParent<Official> _parentBehind;
@inject INavigator _navigator

<h3>StaffMember</h3>

<EditForm Model="_model">
    <DataAnnotationsValidator />

    <MudCard>
        <OfficialFields Model="_model" @ref="Fields" />
    </MudCard>
</EditForm>

<MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="TryUpdate">Update</MudButton>
    
@code {
    private OfficialFieldsModel _model = default!;

    protected override void OnInitialized()
    {
        _model = new(_navigator.ConsumeParameter<Official>());
    }

    protected override async Task Update()
    {
        var entity = Fields!.SubmitUpdate();
        await _parentBehind.Update(entity);
        _navigator.NavigateTo(SETUP_PAGE);
    }
}
