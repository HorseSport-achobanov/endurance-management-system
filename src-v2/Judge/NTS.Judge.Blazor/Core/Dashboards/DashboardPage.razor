@using NTS.Domain.Setup.Entities
@using NTS.Judge.Blazor.Core.Dashboards.Actions
@using NTS.Judge.Blazor.Core.Dashboards.Actions.Eliminations
@using NTS.Judge.Blazor.Core.Dashboards.Actions.Inspections
@using NTS.Judge.Blazor.Core.Dashboards.Actions.Snapshots
@using NTS.Judge.Blazor.Core.Dashboards.Component
@using NTS.Judge.Blazor.Shared.EnduranceEventState

@attribute [Route(DASHBOARD_PAGE)]
@inherits NComponent

<NContent Title="Dashboard" HasContent="_isStarted" EmptyMessage="Event isn't started">
    
    <EmptyContent>
        <InputFile OnChange="ImportEmsData" />
    </EmptyContent>

    <Main>
        <Dashboard />
    </Main>

    <Rightbar>
        <ActionsMenu />
    </Rightbar>

</NContent>

@code {
    bool _isStarted;

    [Inject]
    ICoreBehind CoreBehind { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        _isStarted = await CoreBehind.IsStarted();
    }

    async Task ImportEmsData(InputFileChangeEventArgs args)
    {
        using var stream = args.File.OpenReadStream();
        using var stringReader = new StreamReader(stream);
        var contents = await stringReader.ReadToEndAsync();
        if (contents == null)
        {
            return;
        }
        await CoreBehind.Import(contents);
    }
}
