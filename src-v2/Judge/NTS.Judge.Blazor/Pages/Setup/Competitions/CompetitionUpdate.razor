@using NTS.Domain.Setup.Entities;
@using NTS.Judge.Blazor.Pages.Setup.Phases
@using Not.Blazor.Components;
@using Not.Blazor.Navigation;
@using Not.Blazor.TM
@using Not.Blazor.TM.Forms.Components
@using NTS.Judge.Blazor.Pages.Setup.Contestants


@attribute [Route(COMPETITION_UPDATE)]
@inherits NotComponent

<MudPaper Elevation="0" Class="pl-6 pr-6">
    <NotH2>@Localizer.Get("Update Competition")</NotH2>
    <NotFormUpdate T="Competition" TForm="CompetitionForm" Entity="_competition" UpdateAction="Update" />
</MudPaper>

<MudPaper Class="d-flex justify-space-between pr-6" Elevation="0">
    <NotSetList Name="Phases" T="Phase" TForm="PhaseForm" UpdateRoute="@PHASE_UPDATE" />
    <MudDivider Vertical="true" FlexItem="true" />
    <NotSetList Name="Contestants" T="Contestant" TForm="ContestantForm" UpdateRoute="@CONTESTANT_UPDATE" />
</MudPaper>

@code {   
    private Competition _competition { get; set; } = default!;
    [Inject]
    private INotSetBehind<Competition> _setBehind { get; set; } = default!;
    [Inject]
    private INotParentBehind<Competition> _competitionWithChildren { get; set; } = default!;
    [Inject]
    private INavigator _navigator { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        _competition = _navigator.ConsumeParameter<Competition>();
        await _competitionWithChildren.Initialize(_competition.Id);
    }

    protected async Task Update(Competition competition)
    {
        await _setBehind.Update(competition);
        _navigator.NavigateTo(SETUP_PAGE);
    }
}
