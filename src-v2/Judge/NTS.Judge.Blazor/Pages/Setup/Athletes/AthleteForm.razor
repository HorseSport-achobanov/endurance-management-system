@using NTS.Domain.Objects
@using NTS.Domain.Setup.Entities;
@using NTS.Judge.Blazor.Contexts
@using Not.Blazor.Forms;
@using Not.Blazor.TM.Forms;
@using Not.Blazor.TM.Forms.Components;

@inherits NotForm<Athlete>;

<EditForm Model="_model">
    <MudTextField @ref="_nameField" @bind-Value="_model.Name" Label="@Localizer.Get("Name")" />
    <MudTextField @bind-Value="_model.FeiId" Label="Fei Id" HelperText="@Localizer.Get("Required for FEI export")" Variant="Variant.Text" Margin="Margin.Dense" />
    <MudAutocomplete T="Country" @ref="_countryField" @bind-Value="_model.Country" Label="@Localizer.Get(nameof(Athlete.Country))"
                     CoerceText="true"
                     SearchFunc="_countries.Search" />
    <MudTextField @bind-Value="_model.Club" Label="Club" Variant="Variant.Text" Margin="Margin.Dense" />
    <MudTextField @bind-Value="_model.Category" Label="Category" Variant="Variant.Text" Margin="Margin.Dense" />
</EditForm>

@code {
    private MudTextField<string> _nameField = default!;
    private MudTextField<string?> _feiIdField = default!;
    private MudAutocomplete<Country?> _countryField = default!;
    private MudTextField<string> _clubField = default!;
    private MudTextField<string> _categoryField = default!;
    private AthleteFormModel _model { get; set; } = new();

    [Inject]
    private ICountriesContext _countries { get; set; } = default!;

    public override void RegisterValidationInjectors()
    {
        RegisterInjector(nameof(_model.Name), () => _nameField);
        RegisterInjector(nameof(_model.Country), () => _countryField);
    }

    public override void SetUpdateModel(Athlete Athlete)
    {
        _model = new AthleteFormModel(Athlete);
    }

    public override Athlete SubmitCreate()
    {
        return Athlete.Create(_model.Name, _model.FeiId, _model.Country, _model.Club, _model.Category);
    }

    public override Athlete SubmitUpdate()
    {
        return Athlete.Update(_model.Id, _model.Name, _model.FeiId, _model.Country, _model.Club, _model.Category);
    }
}