@using NTS.Domain.Setup.Entities
@using NTS.Judge.Blazor.Pages.Setup.Athletes
@using NTS.Judge.Blazor.Pages.Setup.Events
@using NTS.Judge.Blazor.Pages.Setup.Loops
@using NTS.Judge.Blazor.Pages.Setup.Officials
@using NTS.Judge.Blazor.Pages.Setup.Competitions
@using NTS.Judge.Blazor.Pages.Setup.Contestants
@using NTS.Judge.Blazor.Pages.Setup.Horses
@using NTS.Judge.Blazor.Pages.Setup.Combinations
@using Not.Blazor.TM
@using Not.Blazor.TM.Forms.Components
@using Not.Blazor.TM.Pages

@attribute [Route(ENDURANCE_EVENT_PAGE)]
@inherits NotComponent

<NotPage Title="Configure Endurance Event" HasContent="_event != null" EmptyMessage="Endurance Event is not created yet :)">

    <EmptyContent>
        <NotButtonCreate OnClick="OpenCreateForm" />
    </EmptyContent>

    <Main>
        <MudGrid Spacing="8" Style="margin-top:0!important;">
            <MudItem xs="12">
                <NotFormUpdate T="Event" TForm="EventForm" Entity="_event!" UpdateAction="_behind.Update" />
                <MudDivider Class="mt-4" />
            </MudItem>

            <MudItem xs="12">
                <CompetitionGrid />
            </MudItem>

            <MudItem xs="6">
                <NotSetList Name="Officials" T="Official" TForm="OfficialForm" UpdateRoute="@OFFICIAL_UPDATE" />
            </MudItem>

        </MudGrid>
    </Main>

</NotPage>

@code {
    private Event? _event;

    [Inject]
    private INotBehind<Event> _behind { get; set; } = default!;
    [Inject]
    private IFormNavigator<Event, EventForm> _formNavigator { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        await InitializeEnduranceEvent();
    }

    private async Task OpenCreateForm()
    {
        await _formNavigator.Create();
        await InitializeEnduranceEvent();
    }

    async Task InitializeEnduranceEvent()
    {
        _event = await _behind.Initialize(0);
    }
}