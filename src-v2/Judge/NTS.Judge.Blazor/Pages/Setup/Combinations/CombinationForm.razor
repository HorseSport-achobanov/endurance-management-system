@using NTS.Domain.Setup.Entities;
@using Not.Blazor.Forms;
@using Not.Blazor.TM;
@using Not.Blazor.TM.Models;
@using Not.Blazor.TM.Forms;
@using Not.Blazor.TM.Forms.Components;

@inherits FormTM<CombinationFormModel>

<EditForm Model="Model">
    <MudNumericField @ref="_numberField" @bind-Value="Model.Number" T="int" Min="0" Label="@Localizer.Get("Combination Number")" />

    <NotSelect @ref="_athleteField" @bind-Value="Model.Athlete" T="Athlete" Label="Athlete" Placeholder="Select an athlete" Items="_athletes" />

    <NotSelect @ref="_horseField" @bind-Value="Model.Horse" T="Horse" Label="Horse" Placeholder="Select a horse" Items="_horses" />
</EditForm>

@code {
    MudNumericField<int> _numberField = default!;
    NotSelect<Athlete> _athleteField = default!;
    NotSelect<Horse> _horseField = default!;
    List<NotListModel<Athlete>> _athletes = [];
    List<NotListModel<Horse>> _horses = [];

    [Inject]
    INotSetBehind<Athlete> _athleteSetBehind { get; set; } = default!;
    [Inject]
    INotSetBehind<Horse> _horseSetBehind { get; set; } = default!;

    protected async override Task OnInitializedAsync()
    {
        var athletes = await _athleteSetBehind.GetAll();
        var horses = await _horseSetBehind.GetAll();
        _athletes = NotListModel.FromEntity<Athlete>(athletes).ToList();
        _horses = NotListModel.FromEntity<Horse>(horses).ToList();
    }

    public override void RegisterValidationInjectors()
    {
        RegisterInjector(nameof(Model.Number), () => _numberField);
        RegisterInjector(nameof(Model.Athlete), () => _athleteField);
        RegisterInjector(nameof(Model.Horse), () => _horseField);
    }
}