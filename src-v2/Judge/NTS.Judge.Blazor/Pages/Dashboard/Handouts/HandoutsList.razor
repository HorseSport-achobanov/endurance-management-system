@using NTS.Judge.Blazor.Pages.Dashboard.Components
@using NTS.Judge.Blazor.Ports

@inherits NotComponent

<MudGrid Style="margin-top:0!important;">
    <MudItem xs="11">
        <MudPaper Elevation="1" Class="pa-4">
            <MudStack>
                @foreach (var handout in _behind.Handouts)
                {
                    var header = handout.Header;
                    <MudItem>
                        <MudItem Class="d-flex flex-row">
                            <MudItem Class="mr-4">
                                <MudStack Style="height:100%; max-width:300px">
                                    <NotH2>@header.Title</NotH2>
                                    <NotH3>@($"{header.PopulatedPlace} {header.EventSpan}")</NotH3>
                                    <MudDivider Style="flex-grow:0;"/>
                                    @* //TODO: fix role display for officials*@
                                    @if (header.PresidentGroundJury != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.PresidentGroundJury</MudText>
                                    }
                                    @if (header.PresidentVet != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.PresidentVet</MudText>
                                    }
                                    @if (header.FeiVetDelegate != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.FeiVetDelegate</MudText>
                                    }
                                    @if (header.FeiTechDelegate != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.FeiTechDelegate</MudText>
                                    }
                                    @if (header.ActiveVet != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.ActiveVet</MudText>
                                    }
                                    @if (header.ForeignJudge != null)
                                    {
                                        <MudText Typo="Typo.body2">@header.ForeignJudge</MudText>
                                    }
                                    <MudSpacer />

                                    <MudItem Class="d-flex flex-row">
                                        <MudImage Src="images/logo-bfks.JPG" />
                                        <MudImage Src="images/logo-fei.JPG" />
                                    </MudItem>
                                </MudStack>
                            </MudItem>

                            <MudItem>
                                <MudText Typo="Typo.h5">@($"{handout.Tandem.Number} {handout.Tandem.Name}, {handout.Tandem.Horse}")</MudText>
                                <ParticipationTable Phases="handout.Phases"/>
                            </MudItem>
                        </MudItem>
                    </MudItem>

                    <MudDivider />
                }
            </MudStack>
        </MudPaper>
    </MudItem>
    <MudItem>
        <NotButtonPrimary OnClick="PopAndPrint">Print</NotButtonPrimary>
    </MudItem>
</MudGrid>

@code {
    [Inject]
    IHandoutsBehind _behind { get; set; } = default!;

    protected override void OnInitialized()
    {
        Observe(_behind);
    }

    private void PopAndPrint()
    {
        var handouts = _behind.PopAll();
    }
}
