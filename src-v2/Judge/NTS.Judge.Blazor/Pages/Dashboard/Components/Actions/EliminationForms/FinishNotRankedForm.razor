@using NTS.Domain.Core.Aggregates.Participations
@using NTS.Judge.Blazor.Enums
@using NTS.Judge.Blazor.Ports
@using System.Diagnostics

@inherits NotComponent


<MudTextField @ref="reasonInput" @bind-Value="Reason" Label="Reason" Variant="Variant.Outlined"></MudTextField>

<MudButton Class="mt-4 one-third-width" Variant="Variant.Filled" Color="Color.Primary" OnClick="Revoke">
    @Localizer.Get("Eliminate");
</MudButton>

<MudButton Class="mt-4 one-third-width" Variant="Variant.Filled" Color="Color.Primary" OnClick="Restore">
    @Localizer.Get("Restore")
</MudButton>

@code {
    [Inject]
    IParticipationBehind _participationBehind { get; set; } = default!;
    [Parameter]
    public FinishedNotRanked? FinishedNotRanked { get; set; } = default!;
    private string? Reason
    {
        get => FinishedNotRanked != null ? FinishedNotRanked.Complement : _value;
        set { _value = value; }
    }
    private string? _value;
    private MudTextField<string?> reasonInput = default!;

    public async Task Revoke()
    {
        Participation? participation = _participationBehind.SelectedParticipation;
        var tandemNumber = participation!.Tandem.Number;
        var reason = Reason;
        await _participationBehind.RevokeQualification(tandemNumber, QualificationRevokeType.FinishNotRanked, reason);   
    }

    public async Task Restore()
    {
        Participation? participation = _participationBehind.SelectedParticipation;
        var tandemNumber = participation!.Tandem.Number;
        _value = null;
        await _participationBehind.RestoreQualification(tandemNumber);
    }
}
