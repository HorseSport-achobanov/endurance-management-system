@using NTS.Domain.Core.Objects
@using NTS.Judge.Blazor.Ports
@using System.Collections
@using Not.Blazor.TM
@using Not.Blazor.TM.Models
@using Not.Extensions

@inherits StartlistTabs

@if (Starts.Count()!=0)
{
    <MudTabs PanelClass="px-4 py-6" Elevation="0" Rounded ApplyEffectsToContainer Class="@Class">
        @foreach (var tabHeader in StartlistByStage.Keys)
        {
            <MudTabPanel Text="@tabHeader">
                <ChildContent>
                    <NSimpleTable T="Start" Headings="@_tableHeadings" Items="StartlistByStage[tabHeader]">
                        <CustomCell>
                            <StartlistTimer StartTime="@context.Time" StopTimerAtTime="-15" />
                        </CustomCell>
                    </NSimpleTable>
                </ChildContent>
            </MudTabPanel>
        }
    </MudTabs>
}

@code{
    [Inject]
    public IStartlistUpcoming _behind { get; set; } = default!;

    public override IEnumerable<Start> Starts => _behind.Upcoming;

    string[] _tableHeadings = { "Number", "Athlete", "Loop", "Start Time", "Start In" };

    protected override async Task OnInitializedAsync()
    {
        await Observe(_behind);
        CreateHeadersAndGroupByStage();
    }

    protected override void OnBeforeRender()
    {
        CreateHeadersAndGroupByStage();
    }
}